<!DOCTYPE html>
<html lang="en-US" xmlns:og="http://ogp.me/ns#" xmlns:fb="http://ogp.me/ns/fb"
    class="en js csstransforms csstransforms3d csstransitions">

<head>
    <meta http-equiv="body-Type" body="text/html; charset=UTF-8">
    <title> Custom Element - Accessibility Checker</title>
    <!-- Kentico Custom elements API-->
    <link rel="stylesheet" href="custom-element.css" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <script src="https://app.kontent.ai/js-api/custom-element/v1/custom-element.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/rxjs@6.4.0/bundles/rxjs.umd.min.js"></script>
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@kontent-ai/delivery-sdk@latest/dist/bundles/kontent-delivery.umd.min.js"></script>
    <style></style>
</head>

<body>
    <br />
    <div class="ui container">
        <div class="ui grid">
            <div class="ui sixteen column">
                <div id="body" style="display:none">No body found</div>
                <p id="result">&nbsp;</p>
            </div>
        </div>
    </div>

    <script>
        var h1included = false;

        $(document).ready(function () {
            function processData(response) {
                CustomElement.setHeight(300);
                console.log(response)
                document.getElementById('result').innerHTML = giveFeedback(response.data.items);
            }

            CustomElement.init((element, _context) => {
                config = element.config || {};
                previewApiKey = config.previewApiKey;
                const Kk = window['kontentDelivery'];
                const deliveryClient = new Kk.DeliveryClient({
                    environmentId: _context.projectId,
                    previewApiKey: previewApiKey,
                    defaultQueryConfig: {
                        usePreviewMode: true
                    }
                });

                // Retrieves the landing page from your project
                deliveryClient
                    .items()
                    .equalsFilter("system.name", _context.item.name)
                    .toPromise()
                    .then(response => {
                        processData(response)
                    });

                CustomElement.observeElementChanges(["content"], (changedElementCodenames) => {
                    setTimeout(function () {
                        deliveryClient
                            .items()
                            .equalsFilter("system.name", _context.item.name)
                            .toPromise()
                            .then(response => {
                                processData(response)
                            });
                    }, 3000);
                });
            });
        });


        function giveFeedback(items) {
            
            var result = "";
            if (items.lenght == 0) {
                return "No duplicates found";
            }
            if (items.lenght > 1) {
                result = "<p>Found " + items.lenght + " duplicates</p>";
                items.array.forEach(element => {
                    result += "<p>" + element.system.name + "</p>";
                });
            }
            return result;
        }
    </script>
</body>

</html>